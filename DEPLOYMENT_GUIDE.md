# OpenWebUI Separation and Deployment Guide

This guide explains how to deploy OpenWebUI with separated frontend and backend for enhanced security.

## Overview

By separating the frontend and backend, you:
- **Prevent API leaks** - No backend code or API keys in frontend
- **Improve security** - Backend is isolated and protected
- **Enable independent scaling** - Frontend and backend can scale separately
- **Reduce attack surface** - Frontend has no access to sensitive data

## Architecture

```
┌─────────────────┐    API Calls    ┌─────────────────┐
│   Frontend      │ ──────────────→ │    Backend      │
│   (Vercel)      │                 │   (Render.com)  │
│                 │ ←────────────── │                 │
└─────────────────┘    Responses    └─────────────────┘
```

## Step 1: Deploy Backend to Render.com

### 1.1 Prepare Backend Repository

1. **Copy backend files** to a new repository:
   ```bash
   git clone https://github.com/your-username/openwebui-backend.git
   cd openwebui-backend
   ```

2. **Copy the backend files** from this separation:
   - `main.py`
   - `requirements.txt`
   - `render.yaml`
   - `README.md`

3. **Copy OpenWebUI backend modules**:
   ```bash
   cp -r /path/to/original/open-webui/backend/open_webui ./
   cp -r /path/to/original/open-webui/backend/open_webui/internal ./
   cp -r /path/to/original/open-webui/backend/open_webui/models ./
   cp -r /path/to/original/open-webui/backend/open_webui/routers ./
   cp -r /path/to/original/open-webui/backend/open_webui/utils ./
   cp -r /path/to/original/open-webui/backend/open_webui/socket ./
   cp -r /path/to/original/open-webui/backend/open_webui/retrieval ./
   cp -r /path/to/original/open-webui/backend/open_webui/migrations ./
   cp -r /path/to/original/open-webui/backend/open_webui/static ./
   ```

### 1.2 Deploy to Render.com

1. **Connect repository** to Render
2. **Use render.yaml** for automatic configuration
3. **Set environment variables**:
   - `WEBUI_URL`: Your frontend domain (e.g., `https://your-app.vercel.app`)
   - `CORS_ORIGINS`: Your frontend domain
   - `WEBUI_SECRET_KEY`: Auto-generated by Render
4. **Deploy** and note the backend URL

## Step 2: Deploy Frontend to Vercel

### 2.1 Prepare Frontend Repository

1. **Copy frontend files** to a new repository:
   ```bash
   git clone https://github.com/your-username/openwebui-frontend.git
   cd openwebui-frontend
   ```

2. **Copy the frontend files** from this separation:
   - `package.json`
   - `vite.config.ts`
   - `svelte.config.js`
   - `tsconfig.json`
   - `vercel.json`
   - `env.example`
   - `README.md`

3. **Copy OpenWebUI frontend source**:
   ```bash
   cp -r /path/to/original/open-webui/src ./
   cp -r /path/to/original/open-webui/static ./
   cp -r /path/to/original/open-webui/cypress ./
   cp -r /path/to/original/open-webui/scripts ./
   cp -r /path/to/original/open-webui/i18next-parser.config.ts ./
   cp -r /path/to/original/open-webui/postcss.config.js ./
   cp -r /path/to/original/open-webui/tailwind.config.js ./
   ```

4. **Update constants.ts** to point to your backend:
   ```typescript
   // Update this line in src/lib/constants.ts
   const BACKEND_API_URL = import.meta.env.VITE_BACKEND_API_URL || 'https://your-backend-app.onrender.com';
   ```

### 2.2 Deploy to Vercel

1. **Connect repository** to Vercel
2. **Set environment variables**:
   - `VITE_BACKEND_API_URL`: Your Render backend URL
3. **Deploy** and note the frontend URL

## Step 3: Configure CORS and Security

### 3.1 Update Backend CORS

In your backend `main.py`, update the CORS origins:

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://your-frontend-domain.vercel.app"],  # Your frontend domain
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 3.2 Update Frontend Backend URL

In your frontend environment variables:

```bash
VITE_BACKEND_API_URL=https://your-backend-app.onrender.com
```

## Step 4: Test the Separation

### 4.1 Test Frontend-Backend Communication

1. **Open your frontend** in a browser
2. **Check browser console** for any CORS errors
3. **Try to log in** - this should make API calls to your backend
4. **Verify API calls** in Network tab

### 4.2 Test Security

1. **Inspect frontend source** - should contain no API keys
2. **Check backend logs** - should show requests from frontend
3. **Verify CORS** - requests from other domains should be blocked

## Step 5: Production Configuration

### 5.1 Environment Variables

**Frontend (Vercel):**
```bash
VITE_BACKEND_API_URL=https://your-backend-app.onrender.com
```

**Backend (Render):**
```bash
WEBUI_URL=https://your-frontend-domain.vercel.app
CORS_ORIGINS=https://your-frontend-domain.vercel.app
DATABASE_URL=your_postgresql_url
REDIS_URL=your_redis_url
WEBUI_SECRET_KEY=your_secret_key
```

### 5.2 Custom Domain (Optional)

1. **Frontend**: Configure custom domain in Vercel
2. **Backend**: Configure custom domain in Render
3. **Update CORS** and environment variables accordingly

## Troubleshooting

### Common Issues

1. **CORS Errors**:
   - Check `CORS_ORIGINS` in backend
   - Verify frontend domain is correct
   - Ensure backend allows credentials

2. **API Connection Errors**:
   - Verify `VITE_BACKEND_API_URL` is correct
   - Check backend is running and accessible
   - Test backend health endpoint

3. **Authentication Issues**:
   - Check `WEBUI_SECRET_KEY` is set
   - Verify JWT token handling
   - Check session configuration

### Debug Commands

**Backend Health Check:**
```bash
curl https://your-backend-app.onrender.com/health
```

**Frontend Environment Check:**
```javascript
console.log(import.meta.env.VITE_BACKEND_API_URL);
```

## Security Benefits

✅ **API Key Protection**: No API keys in frontend code
✅ **Backend Isolation**: Backend is completely separate
✅ **CORS Protection**: Only your frontend can access backend
✅ **Reduced Attack Surface**: Frontend has minimal sensitive data
✅ **Independent Scaling**: Frontend and backend scale separately

## Cost Optimization

- **Vercel**: Free tier for frontend hosting
- **Render**: Free tier for backend (with limitations)
- **Database**: Use Render's free PostgreSQL
- **Redis**: Use Render's free Redis

## Monitoring and Maintenance

1. **Set up alerts** for backend health
2. **Monitor API usage** and performance
3. **Regular security updates** for dependencies
4. **Backup database** regularly
5. **Monitor CORS violations** in logs

## Next Steps

1. **Set up monitoring** and alerting
2. **Configure custom domains** if needed
3. **Set up CI/CD** for automatic deployments
4. **Implement rate limiting** and additional security measures
5. **Set up backup strategies** for your data

## Support

For issues with this separation:
1. Check the troubleshooting section
2. Review Render and Vercel documentation
3. Check OpenWebUI GitHub issues
4. Verify environment variables and configuration
